<source>
  @type         syslog
  protocol_type tcp
  port          5140
  bind          0.0.0.0
  tag           rsyslog
  <parse>
    @type       csv
    keys        1,2,3,4,5,6,7,8,9
  </parse>
</source>

<match rsyslog.**>
  @type     rewrite_tag_filter
  <rule>
    key     2
    pattern /start/
    tag     start
  </rule>
  <rule>
    key     2
    pattern /complete/
    tag     complete
  </rule>
</match>

# format: 2021-06-17T19:06:28Z ip-172-31-3-25 strongDM[44495]: 2021-06-17 19:06:28.017624404 +0000 UTC,start,01sfRGaM7BDXf3nQgxxpIpKU7YS7,rs-26a4c33360a277fe,docker-postgres,a-0326fcc060460b7d,Rodolfo Campos,select 'a';,817fa457ceb5e2c1869e011611651e8f8f945584
<filter start.**>
  @type           record_transformer
  enable_ruby     true
  <record>
    date          ${record["1"].scan(/([0-9]+-[0-9]+-[0-9]+T[0-9]+:[0-9]+:[0-9]+Z).*/).last.first}
    description   ${record["2"]}
    id            ${record["3"]}
    resource_id   ${record["4"]}
    resource_name ${record["5"]}
    account_id    ${record["6"]}
    account_name  ${record["7"]}
    command       ${record["8"]}
    session_id    ${record["9"]}
  </record>
  remove_keys     1,2,3,4,5,6,7,8,9
</filter>

<match **>
  @type stdout
</match>
